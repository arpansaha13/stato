import*as f from"vue";import{defineComponent as d,ref as m,shallowRef as h,h as c,Suspense as w,nextTick as $,createApp as j}from"vue";import{compileTemplate as R}from"vue/compiler-sfc";function v(t,n){import.meta.hot&&import.meta.hot.on(t,n)}const{defineComponent:p,h:b,shallowRef:O,toRaw:S,toRef:g,watch:k}=f,C=p({name:"StoryRenderer",props:{story:{type:Object,default:{}}},async setup(t){const n=O(p({}));function l(){const a=t.story.components?S(t.story.components):{},r=new Function("Vue",R({source:t.story.template??"<div></div>",compilerOptions:{mode:"function"},id:"story",filename:"anonymous.vue"}).code)(f);n.value=p({name:"Story",components:a,setup(){const e=t.story.setup?t.story.setup():null;return r.bind(this,e)}})}const s=g(t,"story");return k(s,l,{immediate:!0}),()=>b(n.value)}}),N=d({setup(){const t=m(null),n=m(null),l=m(null),s=h({}),a=m(null);async function r(){const e=Date.now();let o=t.value;a.value&&(o=`${a.value}/${o}`);const u=o.split("."),i=u.pop();return o=u.join("."),i==="js"?import(`./stories/${o}.js?t=${e}`):import(`./stories/${o}.stories.ts?t=${e}`)}return v("stato-iframe:select-story",async({nesting:e,fileName:o,storyName:u})=>{const i=e.join("/");if(a.value!==i||t.value!==o){a.value=i,t.value=o;const{default:y}=await r();l.value=y}n.value=u,s.value=l.value.stories[u]}),v("stato-iframe:re-import",async()=>{if(t.value===null)return;const{default:e}=await r();l.value=e,s.value={},$(()=>{s.value=e.stories[n.value]})}),()=>c("main",null,c(w,null,{default:[c(C,{story:s.value})],fallback:[c("div",null)]}))}});j(N).mount("#iframe");
