import*as f from"vue";import{defineComponent as y,ref as i,shallowRef as d,h as m,Suspense as h,nextTick as w,createApp as b}from"vue";import{compileTemplate as k}from"vue/compiler-sfc";function c(e,o){import.meta.hot&&import.meta.hot.on(e,o)}const{defineComponent:p,h:R,shallowRef:$,toRaw:S,toRef:j,watch:O}=f,x=p({name:"StoryRenderer",props:{story:{type:Object,default:{}}},async setup(e){const o=$(p({}));function s(){const n=e.story.components?S(e.story.components):{},u=new Function("Vue",k({source:e.story.template??"<div></div>",compilerOptions:{mode:"function"},id:"story",filename:"anonymous.vue"}).code)(f);o.value=p({name:"Story",components:n,setup(){const t=e.story.setup?e.story.setup():null;return u.bind(this,t)}})}const a=j(e,"story");return O(a,s,{immediate:!0}),()=>R(o.value)}}),C=y({setup(){const e=i(null),o=i(null),s=i(null),a=i(null),n=d({});async function u(t,r){const l=Date.now();return r===".js"?import(`./stories/${t}.stories.js?t=${l}`):import(`./stories/${t}.stories.ts?t=${l}`)}return c("stato-iframe:select-story",async({bookName:t,storyName:r,ext:l})=>{if(e.value!==t){const{default:v}=await u(t,l);a.value=v,o.value=l,e.value=t}s.value=r,n.value=a.value.stories[r]}),c("stato-iframe:re-import",async()=>{if(e.value===null||o.value===null)return;const{default:t}=await u(e.value,o.value);a.value=t,n.value={},w(()=>{n.value=t.stories[s.value]})}),c("stato-iframe:book-unlinked",t=>{e.value===t&&(e.value=null,s.value=null,n.value={})}),()=>m("main",null,m(h,null,{default:[m(x,{story:n.value})],fallback:[m("div",null)]}))}});b(C).mount("#iframe");
