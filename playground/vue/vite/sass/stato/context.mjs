import*as f from"vue";import{defineComponent as w,ref as u,shallowRef as $,h as m,Suspense as R,nextTick as b,createApp as j}from"vue";import{compileTemplate as k}from"vue/compiler-sfc";function y(t,e){import.meta.hot&&import.meta.hot.on(t,e)}const{defineComponent:c,h:O,shallowRef:S,toRaw:x,toRef:C,watch:N}=f,T=c({name:"StoryRenderer",props:{story:{type:Object,default:{}}},async setup(t){const e=S(c({}));function r(){const s=t.story.components?x(t.story.components):{},a=new Function("Vue",k({source:t.story.template??"<div></div>",compilerOptions:{mode:"function"},id:"story",filename:"anonymous.vue"}).code)(f);e.value=c({name:"Story",components:s,setup(){const i=t.story.setup?t.story.setup():null;return a.bind(this,i)}})}const l=C(t,"story");return N(l,r,{immediate:!0}),()=>O(e.value)}}),g=w({setup(){const t=u(null),e=u(null),r=u(null),l=u(null),s=$({}),a=u(null);async function i(){const o=Date.now();let n=t.value;return a.value&&(n=`${a.value}/${n}`),e.value===".js"?import(`./stories/${n}.stories.js?t=${o}`):import(`./stories/${n}.stories.ts?t=${o}`)}return y("stato-iframe:select-story",async({nesting:o,bookName:n,storyName:p,ext:d})=>{const v=o.join("/");if(a.value!==v||t.value!==n){a.value=v,e.value=d,t.value=n;const{default:h}=await i();l.value=h}r.value=p,s.value=l.value.stories[p]}),y("stato-iframe:re-import",async()=>{if(t.value===null)return;const{default:o}=await i();l.value=o,s.value={},b(()=>{s.value=o.stories[r.value]})}),()=>m("main",null,m(R,null,{default:[m(T,{story:s.value})],fallback:[m("div",null)]}))}});j(g).mount("#iframe");
