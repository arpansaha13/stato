import*as f from"vue";import{defineComponent as d,ref as c,shallowRef as $,h as m,Suspense as h,nextTick as j,createApp as w}from"vue";import{compileTemplate as R}from"vue/compiler-sfc";function v(t,n){import.meta.hot&&import.meta.hot.on(t,n)}const{defineComponent:p,h:b,shallowRef:k,toRaw:O,toRef:S,watch:C}=f,N=p({name:"StoryRenderer",props:{story:{type:Object,default:{}}},async setup(t){const n=k(p({}));function r(){const a=t.story.components?O(t.story.components):{},l=new Function("Vue",R({source:t.story.template??"<div></div>",compilerOptions:{mode:"function"},id:"story",filename:"anonymous.vue"}).code)(f);n.value=p({name:"Story",components:a,setup(){const e=t.story.setup?t.story.setup():null;return l.bind(this,e)}})}const s=S(t,"story");return C(s,r,{immediate:!0}),()=>b(n.value)}}),T=d({setup(){const t=c(null),n=c(null),r=c(null),s=$({}),a=c(null);async function l(){const e=Date.now();let o=t.value;a.value&&(o=`${a.value}/${o}`);const u=o.split("."),i=u.pop();switch(o=u.join("."),i){case"js":return import(`./stories/${o}.js?t=${e}`);case"ts":return import(`./stories/${o}.ts?t=${e}`);case"mjs":return import(`./stories/${o}.mjs?t=${e}`);case"cjs":return import(`./stories/${o}.cjs?t=${e}`)}}return v("stato-iframe:select-story",async({nesting:e,fileName:o,storyName:u})=>{const i=e.join("/");if(a.value!==i||t.value!==o){a.value=i,t.value=o;const{default:y}=await l();r.value=y}n.value=u,s.value=r.value.stories[u]}),v("stato-iframe:re-import",async()=>{if(t.value===null)return;const{default:e}=await l();r.value=e,s.value={},j(()=>{s.value=e.stories[n.value]})}),()=>m("main",null,m(h,null,{default:[m(N,{story:s.value})],fallback:[m("div",null)]}))}});w(T).mount("#iframe");
